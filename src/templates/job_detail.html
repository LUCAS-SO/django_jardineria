{% extends "base.html" %}
{% load duration_filters %}

{% block title %}MEV - Trabajo: Detalles {{ job.pk }}{% endblock %}

{% block content %}

<h2 class="text-xl font-semibold text-primary mb-2">
    {{ job.date }} — {{ job.get_location_display }}
</h2>

<p class="text-gray-700 dark:text-gray-300 text-lg mb-2">
    <strong>Duración:</strong> {{ job.duration|duration }}
</p>

<p class="text-gray-700 dark:text-gray-300 mb-6">
    {{ job.description }}
</p>

<hr class="my-6 border-gray-300 dark:border-gray-700">

<h3 class="text-2xl font-semibold text-primary mb-2">
    Galería
</h3>

<!-- ============= -->
<!-- SWIPER CSS -->
<!-- ============= -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

<!-- ============= -->
<!-- PHOTOSWIPE CSS -->
<!-- ============= -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.css"/>

<!-- SWIPER -->
<div class="swiper mySwiper rounded-xl shadow-lg select-none" style="height: 320px;">
    <div class="swiper-wrapper">

        {% for photo in job.photos.all %}
        <div class="swiper-slide flex justify-center items-center bg-black/10 relative">

            <!-- ENLACE PARA LIGHTBOX -->
            <a 
                href="{{ photo.photo.url }}"
                data-pswp-width="1600"
                data-pswp-height="1200"
                target="_blank"
                class="block w-full h-full"
            >

                <img 
                    src="{{ photo.photo.url }}"
                    alt="Foto del trabajo"
                    class="w-full h-full object-contain rounded-xl cursor-zoom-in"
                    loading="lazy"
                >
            </a>

            <span class="absolute top-2 right-2 px-2 py-1 text-xs font-semibold bg-black/60 text-white rounded">
                {% if photo.before_after == "before" %}Antes{% else %}Después{% endif %}
            </span>

        </div>
        {% endfor %}

    </div>

    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
</div>

<!-- SWIPER JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<!-- PHOTOSWIPE JS -->
<script src="https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js" type="module"></script>

<script type="module">
import PhotoSwipeLightbox from "https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js";

document.addEventListener("DOMContentLoaded", function () {

    new Swiper(".mySwiper", {
        loop: true,
        centeredSlides: true,
        spaceBetween: 20,
        slidesPerView: 1,
        speed: 500,
        pagination: { el: ".swiper-pagination", clickable: true },
        navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
    });

    // LIGHTBOX
    const lightbox = new PhotoSwipeLightbox({
        gallery: '.mySwiper',
        children: 'a',
        pswpModule: () => import("https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.esm.min.js")
    });
    lightbox.init();
});
</script>

<a href="{% url 'job-list' %}"
   class="inline-block mt-10 px-4 py-2 rounded-xl bg-secondary text-white font-semibold shadow-md hover:bg-secondary/90 active:scale-95 transition">
    Volver al listado
</a>

{% endblock %}
