{% extends "base.html" %}
{% load duration_filters %}

{% block title %}UISE - Trabajo: Detalles {{ job.pk }}{% endblock %}

{% block content %}

<!-- ========================== -->
<!-- CABECERA DEL TRABAJO -->
<!-- ========================== -->
<h2 class="text-xl font-semibold text-primary mb-2">
    {{ job.date }} — {{ job.get_location_display }}
</h2>

<p class="text-gray-700 dark:text-gray-300 text-lg mb-2">
    <strong>Duración:</strong> {{ job.duration|duration }}
</p>

<p class="text-gray-700 dark:text-gray-300 mb-6">
    {{ job.description }}
</p>

<hr class="my-6 border-gray-300 dark:border-gray-700">

<h3 class="text-2xl font-semibold text-primary mb-4">Galería</h3>

<!-- ========================== -->
<!-- CSS Swiper -->
<!-- ========================== -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

<!-- ========================== -->
<!-- SWIPER (optimizado con lazy loading) -->
<!-- ========================== -->
<div class="swiper mySwiper rounded-xl shadow-lg select-none">
    <div class="swiper-wrapper">

        {% for photo in job.photos.all %}
        <div class="swiper-slide">

            <!-- Lazy loading -->
            <img 
                data-src="{{ photo.photo.url }}" 
                alt="Foto del trabajo"
                class="swiper-lazy w-full h-auto object-cover rounded-xl"
            >

            <!-- Preloader minimal -->
            <div class="swiper-lazy-preloader"></div>
        </div>
        {% endfor %}

    </div>

    <!-- CONTROLES -->
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
</div>

<!-- ========================== -->
<!-- JS Swiper -->
<!-- ========================== -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
var swiper = new Swiper(".mySwiper", {
    loop: true,
    centeredSlides: true,
    spaceBetween: 20,

    // LAZY LOAD OPTIMIZADO
    lazy: {
        loadPrevNext: true,
        loadPrevNextAmount: 1,
    },

    pagination: {
        el: ".swiper-pagination",
        clickable: true
    },

    navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev"
    },

    slidesPerView: 1,
    speed: 500,
});
</script>

<!-- BOTÓN VOLVER -->
<a href="{% url 'job-list' %}"
   class="inline-block mt-10 px-4 py-2 rounded-xl bg-secondary text-white font-semibold
          shadow-md hover:bg-secondary/90 active:scale-95 transition">
    Volver al listado
</a>

{% endblock %}
